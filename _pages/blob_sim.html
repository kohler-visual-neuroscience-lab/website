<!DOCTYPE html>
<html>
  <head>
    <title>Blob Similarity</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-free-sort-extra.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  </head>
  <body></body> 
  <script>
      /* create timeline */
    var timeline = [];

    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };

    /* define consent from trial */
    var check_consent = function(elem) {
      if (document.getElementById('consent_checkbox').checked) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
        return false;
      }
      return false;
    };


    // declare the block.
    var consent = {
      type:'external-html',
      url: "consent.html",
      cont_btn: "start",
      check_fn: check_consent
    };


    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, a circle will appear in the center " +
        "of the screen.</p><p>If the circle is <strong>blue</strong>, " +
        "press the letter F on the keyboard as fast as you can.</p>" +
        "<p>If the circle is <strong>orange</strong>, press the letter J " +
        "as fast as you can.</p>" +
        "<div style='width: 700px;'>"+
        "<div style='float: left;'><img src='img/blue.png'></img>" +
        "<p class='small'><strong>Press the F key</strong></p></div>" +
        "<div class='float: right;'><img src='img/orange.png'></img>" +
        "<p class='small'><strong>Press the J key</strong></p></div>" +
        "</div>"+
        "<p>Press any key to begin.</p>"
    };
    timeline.push(welcome, consent, instructions);

    /* test trials */
    var test_stimuli = [
      { stimulus: "img/blue.png", data: {test_part: 'test', correct_response: 'f'}},
      { stimulus: "img/orange.png", data: {test_part: 'test', correct_response: 'j'}}
    ]

    var stim_3D = [];
      for (var i = 1; i <= 8; i++) {
        stim_3D.push("img/select_asym/asym_00" + i + "_3D_ort.png");
        stim_3D.push("img/select_asym/asym_00" + i + "_3D_per.png");
        stim_3D.push("img/select_sym/sym_00" + i + "_3D_ort.png");
        stim_3D.push("img/select_sym/sym_00" + i + "_3D_per.png");
    }

    var stim_2D = [];
      for (var i = 1; i <= 8; i++) {
        stim_2D.push("img/select_asym/asym_00" + i + "_2D_ort.png");
        stim_2D.push("img/select_asym/asym_00" + i + "_2D_per.png");
        stim_2D.push("img/select_sym/sym_00" + i + "_2D_ort.png");
        stim_2D.push("img/select_sym/sym_00" + i + "_2D_per.png");
    }

    var sort_2D = {
      type: 'free-sort',
      stimuli: stim_2D,
      prompt: "<p>Click and drag the images below to sort them so that similar items are close together.</p>",
      sort_area_height: 700,
      sort_area_width: 700,
      sort_area_shape: "ellipse",
      stim_height: 150,
      stim_width: 150
    };

    var sort_3D = Object.assign({}, sort_2D);

    sort_3D["stimuli"]=stim_3D

    timeline.push(sort_2D, sort_3D);

    var debrief_block = {
      type: "html-keyboard-response",
      stimulus: function() {

      var trials = jsPsych.data.get().filter({test_part: 'test'});
      var correct_trials = trials.filter({correct: true});
      var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
      var rt = Math.round(correct_trials.select('rt').mean());

      return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
      "<p>Your average response time was "+rt+"ms.</p>"+
      "<p>Press any key to complete the experiment. Thank you!</p>";
      }
    };

    timeline.push(debrief_block);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function(data){
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
      exclusions: {
        min_width: 1600,
        min_height: 800
      }
    });

  </script>
</html>